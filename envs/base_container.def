Bootstrap:docker
From: pytorch/conda-builder:cuda12.1-2.1

# Copy the conda env file into the container for installation
%files
    ./environment.yml ~/environment.yml

# Container setup
%post -c /bin/bash
    # Set up environment variables
    export KD_PROJECT_HOME="/contained/kdiffusion"
    export K_DIFFUSION_USE_FLASH_2=0
    export K_DIFFUSION_USE_COMPILE=0

    # Install conda environment
    conda env create -f ~/environment.yml
    conda clean --all