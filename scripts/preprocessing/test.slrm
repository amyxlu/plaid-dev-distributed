#!/usr/bin/env bash

#SBATCH --job-name preprocess
#SBATCH --nodes 1
#SBATCH --gpus-per-node 1 
#SBATCH --partition g5
#SBATCH --cpus-per-gpu 8

# Source the user's bashrc to ensure micromamba function is available
source ~/.bashrc

# Ensure micromamba is initialized and the environment is activated
# export MAMBA_EXE='/homefs/home/lux70/.local/bin/micromamba'
# export MAMBA_ROOT_PREFIX='/homefs/home/lux70/micromamba'
# __mamba_setup="$("$MAMBA_EXE" shell hook --shell bash --root-prefix "$MAMBA_ROOT_PREFIX" 2> /dev/null)"
# if [ $? -eq 0 ]; then
#     eval "$__mamba_setup"
# else
#     alias micromamba="$MAMBA_EXE"  # Fallback on help from mamba activate
# fi
# unset __mamba_setup
# 
# # Explicitly use micromamba to activate the environment
# micromamba activate plaid
# micromamba env list

# Debugging information
echo "SLURM_JOB_NODELIST = ${SLURM_JOB_NODELIST}"
echo "SLURM_JOB_ID = ${SLURM_JOB_ID}"
echo "SLURMD_NODENAME = ${SLURMD_NODENAME}"
echo "SLURM_JOB_NUM_NODES = ${SLURM_JOB_NUM_NODES}"

export HYDRA_FULL_ERROR=1
export TOKENIZERS_PARALLELISM=false
cd /homefs/home/lux70/code/plaid/scripts

# Check NVIDIA GPU status
nvidia-smi

micromamba list
